<style>
    #articles #article-title{
        position: relative;
        display: inline-block;
        top: -0.3em;
        left: -0.7em;
    }
</style>
<br />
<span style="font-size: 3.3em;" class="fa fa-podcast"></span>
<h1 id="article-title">
    Websocket Groups
</h1>

<p>
    Web Socket Groups is a feature that allows your clients to create their own web socket connection to the server, and share data with other web sockets on the same server.<br>
    A few important notes to know bfore you enable Web Socket Groups on your server...
</p>

<ul class="card-list">
    <li>
        <span class="fa fa-circle"></span>
        <p>
            Groups exist in the server's Random Access Memory (RAM).<br>
            <small>
                <span class="fa fa-angle-right"></span>
                This means that groups are volatile, so once the server shuts down, all groups are lost.<br />
                <span class="fa fa-angle-right"></span>
                Each group's pointer is held inside a 
                <a target="_blank" href="https://docs.oracle.com/javase/7/docs/api/java/util/Map.html"><u>Map&lt;String,WebSocketGroup&gt;</u></a>
            </small>
        </p>
    </li>
    <li>
        <span class="fa fa-circle"></span>
        <p>
            Each group must be generated through the provided API, which will assign an unique id to the group itself.<br>
            <small>
                The api is located at <a target="_blank" href="/@Set/webSocketGroup"><u>/@Set/webSocketGroup</u></a>.<br>
                If web socket groups are enabled, the server will respond with the id of the created web socket.
            </small>
        </p>
    </li>
</ul>

<h2>How to enable Web Socket Groups</h2>

<p>
    WS groups are disabled by default for the standalone archive.<br>
    In order to enable it, you need to specify some fields in your <b>http.json</b> file.
</p>

<pre><code highlight="javascript">{
    "port":80,
    "webRoot": "www/", //your website directory (relative to this json file)
    "charset": "UTF-8",
    "timeout": 5000,
    "bindAddress": "::", // :: means the server will bind on all available addresses

    "groups":{
        "allow":true
    }
}</code></pre>

<p>
    The field <b>groups</b>, specifies information about your ws groups.<br>
    Set <b>allow</b> to <b>true</b>, and you are done.
</p>

<h2>How to create a Web Socket Group</h2>

<p>
    As I mentioned above, you can create a web socket group through the <b>/@Set/webSocketGroup</b> API.<br>
    The request can be either a GET or a POST request.
    The server will create a group, assign it an unique id based on your session id, a visibility state and a name based on the parameters given.
    The group will be saveed in memory, and the unique id of the group will be sent back to the client through http as a response to the request.
</p>

<pre><code highlight="javascript">async function createGroup(name){
    const req = await fetch("/@Set/webSocketGroup?visibility=1&name="+name);
    const text = req.text();
    return text;
}</code></pre>

<p>
    This function will create a group and return its id.<br />
    <b>Note</b>  that the requests specifies an url query field names  <b>visibility</b>, this field specifies wether the group can be public or private.
</p>

<p>
    You can use that id to actually join the group data stream.
    In order to do so, you must open a web socket connection through the provided api
    <b>/@WebSocketGroupApplicationProgramInterface?join=<u>{id}</u></b>
</p>

<pre><code highlight="javascript">function joinGroup(groupId){
    return new Promise(function(resolve,reject){
        //connect to the api and provide your group id
        const group = new WebSocket("ws://"+location.host+"/@WebSocketGroupApplicationProgramInterface?join="+groupId);

        //check when connection is enstablished
        group.addEventListener("open",e=>{
            //callback on success and return group
            (resolve)(group);
            console.log("Connection enstablished");
        });

        //handle errors
        group.addEventListener("error",e=>{
            //callback on error and return group
            (reject)(group);
            console.log("Connection closed");
        });
    });
}</code></pre>

<p>
    Let's write a simple example, a web chat application with different groups.<br>
    Users can create their own public group to chat with others, and they are free to switch between groups.
</p>

<pre><code highlight="html" src="articles/storage/groups.html"></code></pre>